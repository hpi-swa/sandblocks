<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sandblocks</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="sandblocks.html"><strong aria-hidden="true">1.</strong> Sandblocks</a></li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">2.</strong> Frequently Asked Questions</a></li><li class="chapter-item expanded "><a href="chapter_walkthroughs.html"><strong aria-hidden="true">3.</strong> Walkthroughs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="walkthroughs/squeak.html"><strong aria-hidden="true">3.1.</strong> Setting up Squeak</a></li><li class="chapter-item expanded "><a href="walkthroughs/git.html"><strong aria-hidden="true">3.2.</strong> Working with Git</a></li><li class="chapter-item expanded "><a href="walkthroughs/palettes.html"><strong aria-hidden="true">3.3.</strong> Custom Palettes</a></li><li class="chapter-item expanded "><a href="walkthroughs/blocks.html"><strong aria-hidden="true">3.4.</strong> Custom Blocks</a></li><li class="chapter-item expanded "><a href="walkthroughs/projections.html"><strong aria-hidden="true">3.5.</strong> Custom Projections</a></li><li class="chapter-item expanded "><a href="walkthroughs/commands.html"><strong aria-hidden="true">3.6.</strong> Custom Commands</a></li><li class="chapter-item expanded "><a href="walkthroughs/lists-of-blocks.html"><strong aria-hidden="true">3.7.</strong> Lists of Blocks</a></li><li class="chapter-item expanded "><a href="walkthroughs/drag-and-drop.html"><strong aria-hidden="true">3.8.</strong> Drag and Drop</a></li><li class="chapter-item expanded "><a href="walkthroughs/artefacts.html"><strong aria-hidden="true">3.9.</strong> Saving and Artefacts</a></li><li class="chapter-item expanded "><a href="walkthroughs/shortcuts.html"><strong aria-hidden="true">3.10.</strong> Custom Shortcuts</a></li><li class="chapter-item expanded "><a href="walkthroughs/tree-sitter.html"><strong aria-hidden="true">3.11.</strong> Tree Sitter</a></li><li class="chapter-item expanded "><a href="walkthroughs/tree-sitter-runtimes.html"><strong aria-hidden="true">3.12.</strong> Tree Sitter Runtimes</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Sandblocks</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sandblocks"><a class="header" href="#sandblocks">Sandblocks</a></h1>
<p>Sandblocks is a projectional, block-based programming environment written in Squeak/Smalltalk.</p>
<p>In this documentation, you will find some useful resources to help you get started with extending and working with the editor and environment.</p>
<h1 id="frequently-asked-questions"><a class="header" href="#frequently-asked-questions">Frequently Asked Questions</a></h1>
<p><strong>How do I open a morph in the editor?</strong></p>
<blockquote>
<p>In a Smalltalk workspace (open via the plus button up top), run:</p>
<pre><code>sbEditor openMorphInView: MyBlock new
</code></pre>
</blockquote>
<p><strong>How do I copy-paste text into the blocks?</strong></p>
<blockquote>
<p>Whenever you use ctrl+c on a block, it is also copied to the system clipboard as text.
To paste text from the system clipboard, use ctrl+shift+V.</p>
</blockquote>
<p><strong>How do I select themes and which ones are recommended?</strong></p>
<blockquote>
<p>Right click into the editor or press ctrl+; to open the list of global actions.
Filter for <code>color</code> and press enter.</p>
<p>Currently recommended themes are <code>ColorMinimal</code>, as well as <code>LightPlus</code>, <code>Solarized</code>, and <code>SolarizedDark</code>.</p>
</blockquote>
<p><strong>Where can I find all the shortcuts?</strong></p>
<blockquote>
<p>Have a look at <code>SBTextInputMapping&gt;&gt;#registerDefaultShortcuts</code>.</p>
</blockquote>
<p><strong>How do I (no longer) use the Sandblocks editor as default in all the Squeak tools?</strong></p>
<blockquote>
<p>Run <code>CodeHolder addSandblocksDefault: true</code> or <code>false</code> to still have it as an option but not make it the default.</p>
</blockquote>
<h1 id="walkthroughs"><a class="header" href="#walkthroughs">Walkthroughs</a></h1>
<p>In this chapter, we included a couple of videos that should give you an overview on how to work on and with the system.
It concerns common tasks such as extending the system with new blocks or palettes.</p>
<h1 id="setting-up-squeak"><a class="header" href="#setting-up-squeak">Setting up Squeak</a></h1>
<p>In this walkthrough, we present a couple of preferences that we recommend you enable in Squeak, followed by a couple of debugging or exploration workflows.</p>
<p>In between our image even crashes, so we got to demonstrate recovering unsaved changes you made after a crash.</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://player.vimeo.com/video/541134203" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe></div>
<h1 id="recap"><a class="header" href="#recap">Recap</a></h1>
<ol>
<li><strong>Preferences mentioned</strong>
<ul>
<li>Open tools attached to cursor</li>
<li>Mouse over for keyboard focus</li>
<li>Auto enclose brackets</li>
<li>Enclose selection with brackets</li>
</ul>
</li>
<li><strong>Packages mentioned</strong>
<ul>
<li><a href="https://github.com/LeonMatthes/Autocompletion">Autocompletion</a></li>
<li><a href="https://github.com/hpi-swa/sandblocks">Sandblocks</a></li>
</ul>
</li>
<li><strong>Shortcuts mentioned</strong>
<ul>
<li>Global
<ul>
<li><code>Ctrl+w</code> close window (if adapted in <code>SystemWindow&gt;&gt;#filterEvent:for:</code>)</li>
<li><code>Ctrl+Shift+Q</code> save image (if adapted in <code>PasteUpMorph&gt;&gt;#tryInvokeKeyboardShortcut:</code>)</li>
<li><code>Ctrl+0</code> to focus search</li>
<li><code>Middleclick</code>/<code>Alt+Leftclick</code> open halo (add <code>Shift</code> to start from the innermost)</li>
<li><code>Alt+.</code> halt execution of current process (e.g. when in an infinite loop)</li>
</ul>
</li>
<li>Editing/Evaluating
<ul>
<li><code>Ctrl+f</code> in the class list to find a class</li>
<li><code>Alt+num</code> to insert the num'th argument</li>
<li><code>Ctrl+p</code> print selected expression or full line</li>
<li><code>Ctrl+d</code> do selected expression or full line</li>
<li><code>Ctrl+Shift+I</code> evaluate selected expression or full line and explore result</li>
</ul>
</li>
<li>Exploring code
<ul>
<li><code>Ctrl+b</code> browse class of object or selected class name</li>
<li><code>Ctrl+n</code> show senders of selected symbol</li>
<li><code>Ctrl+m</code> show implementors of selected symbol</li>
<li><code>Ctrl+Shift+N</code> show references to selected variable or class</li>
</ul>
</li>
</ul>
</li>
<li><strong>Methods mentioned</strong>
<ul>
<li><code>self halt</code></li>
<li><code>self haltOnce</code></li>
<li><code>1 setHaltOnce</code></li>
</ul>
</li>
</ol>
<h1 id="working-with-git"><a class="header" href="#working-with-git">Working with Git</a></h1>
<p>Here, we walk through checking out a separate branch, pushing our work, and merging the work of our collaborators.</p>
<p>We also detail how to add packages to an existing Tonel repo.</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://player.vimeo.com/video/541133065" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe></div>
<h2 id="git-commands-mentioned"><a class="header" href="#git-commands-mentioned">Git Commands Mentioned</a></h2>
<ul>
<li><code>git reset --hard</code> reset <strong>all</strong> files in the filesystem to the last commit</li>
<li><code>git fetch --all</code> fetch changes onto our <code>origin/</code> branches but do not merge them just yet</li>
<li><code>git push -u origin BRANCH</code> push a local branch to the remote and remember the <code>origin BRANCH</code> as its upstream so that you can leave it out next time</li>
</ul>
<h2 id="adding-your-repo-in-squeak"><a class="header" href="#adding-your-repo-in-squeak">Adding Your Repo in Squeak</a></h2>
<ol>
<li>Via the commandline, <code>git clone </code> your repo to any folder on your filesystem.</li>
<li>When first opening the Git Browser, it will ask you to add a new project. Click yes.</li>
<li>Locate the folder that you <code>git clone</code>d earlier.</li>
</ol>
<h2 id="recommended-workflow"><a class="header" href="#recommended-workflow">Recommended Workflow</a></h2>
<ol>
<li>Perform changes in the image</li>
<li>Commit using the Git Browser
<ul>
<li><code>Ctrl+x</code> to ignore change for commit</li>
</ul>
</li>
<li><code>git push</code> using the CLI or setup credentials in the Git Browser and use the push button</li>
<li>To merge other people's work, we have three options:
<ol>
<li>use the Git Browser's pull button (need to have credentials setup, no conflict resolution)</li>
<li>run <code>git fetch --all</code> in the CLI, right click the origin branch and click <code>merge</code> (no conflict resolution)</li>
<li><code>git pull</code> in the CLI, then right click new most recent commit and select <code>checkout</code> (might result in invalid Smalltalk, is not aware of uncommitted changes in your image)</li>
</ol>
</li>
<li>When adding packages, right click the project and click &quot;change tracked packages&quot;, add the packages, then make sure to go to settings and re-select the right type of storage format</li>
</ol>
<h2 id="difference-to-metacello"><a class="header" href="#difference-to-metacello">Difference to Metacello</a></h2>
<p>Metacello is a dependency manager that will only fetch the most recent version of the packages you want to install. The Git Browser, on the other hand, will clone and manage the entire history of the repository and allow you to create and push new commits.</p>
<h1 id="custom-palettes"><a class="header" href="#custom-palettes">Custom Palettes</a></h1>
<p>In this walkthrough, we create a custom palette that is only active if we are in a subclass of the <code>System</code> class.</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://player.vimeo.com/video/541133965" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe></div>
<h2 id="recap-the-basic-steps"><a class="header" href="#recap-the-basic-steps">Recap: The Basic Steps</a></h2>
<ol>
<li>Create a subclass of <code>SBPalette</code>.</li>
<li>Implement its <code>#context</code> method on the <strong>class</strong> side to match against the block selection.</li>
<li>Implement the <code>#buildOn</code>: method on the <strong>class</strong> side to return pre-built blocks.</li>
</ol>
<h1 id="custom-blocks"><a class="header" href="#custom-blocks">Custom Blocks</a></h1>
<p>Here, we define a custom block that should act as a little weather widget.</p>
<p>We show how to work with and debug layouts and how to get a live preview of our work while in Sandblocks.</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://player.vimeo.com/video/541133346" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe></div>
<h2 id="recap-interesting-commands"><a class="header" href="#recap-interesting-commands">Recap: Interesting Commands</a></h2>
<ul>
<li><code>sbEditor openMorphInView: MyBlock new</code> when run in a Smalltalk workspace, opens <code>MyBlock</code> in the current editor</li>
<li><code>SBMorphExample</code> autocompletion: expands to a preview window for your block that reloads when you change the code</li>
<li><code>SBIcon</code> class for icons, here's the <a href="https://fontawesome.com/v4.7.0/icons/">full list</a></li>
<li><code>self attachDecorator: SBMoveDecorator new</code>, make the block move when left-click-dragged</li>
<li><code>&lt;action&gt;</code> pragma, mark a method as an action to show up in the context menu and be invokable via shortcuts</li>
<li><code>&lt;globalAction&gt;</code> pragma, a method that should appear in the context menu of the editor (can also be mapped to shortcuts, <code>&lt;action&gt;</code> shortcuts take precedence before <code>&lt;globalAction&gt;</code> shortcuts)</li>
<li><code>SBTextInputMapping&gt;&gt;#registerDefaultShortcuts</code>, list of all shortcut to action mappings</li>
</ul>
<h1 id="custom-projections"><a class="header" href="#custom-projections">Custom Projections</a></h1>
<p>Here, we take the custom block from the previous walkthrough and map it to a Smalltalk constructor. Using this mapping, whenever this constructor is seen in Smalltalk code, it will instead be displayed as our custom block.</p>
<blockquote>
<p><strong>NOTES / API CHANGES:</strong></p>
<ul>
<li>an <code>object ^ self</code> method is no longer necessary but the default</li>
<li>instead of <code>#canAppearInBlockBody</code>, you should now only implement <code>#isExpression</code> (which also sets <code>#canAppearInBlockBody</code>)</li>
</ul>
</blockquote>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://player.vimeo.com/video/541133593" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe></div>
<h2 id="recap-basic-steps"><a class="header" href="#recap-basic-steps">Recap: Basic Steps</a></h2>
<ol start="0">
<li>prepare your custom projection/widget</li>
<li>add a converter method to SBStMessageSend that matches the expressions you want to substitute for (optional: specify it as <code>&lt;automatic&gt;</code>)</li>
<li>implement <code>#writeSourceOn:</code> on your widget to produce Smalltalk code</li>
<li>mark the capabilities of your projection by returning <code>true</code> from <code>#isSmalltalk</code> and <code>#isExpression</code></li>
<li>implement <code>#updatePCFrom:</code> to get debugging support (can leave it empty)</li>
<li>optional: add a converter method back to smalltalk using your <code>#writeSourceOn:</code></li>
</ol>
<h1 id="custom-commands"><a class="header" href="#custom-commands">Custom Commands</a></h1>
<p>To allow for undo and change tracking, all mutations to state in Sandblocks must be performed through commands.
Commands are subclasses of <code>SBCommand</code> that describe the change in the system:</p>
<pre><code>SBReplaceCommand new
    target: ...;
    replacer: ...;
    yourself
</code></pre>
<p>To perform a command, call <code>do:</code> on the SBEditor:</p>
<pre><code>self sandblockEditor do: (SBReplaceCommand new
    target: ...;
    replacer: ...;
    yourself)
</code></pre>
<p>Commands will ensure that the next artefact in the block tree will be marked as having unsaved changes after a command is applied.</p>
<h2 id="combining-commands"><a class="header" href="#combining-commands">Combining Commands</a></h2>
<p>Often, you will want to perform multiple things at once but they should be undo-able with a single click.
For this purpose, you may use the <code>SBCombinedCommand</code>:</p>
<pre><code>SBCombinedCommand newWith: (targets collect: [:target |
    SBDeleteCommand new target: target])
</code></pre>
<h2 id="some-built-in-commands"><a class="header" href="#some-built-in-commands">Some Built-in Commands</a></h2>
<p>Here is a quick overview of some built-in commands. Use Ctrl+Shift+N in the Squeak image to see how each is used.</p>
<table><thead><tr><th>Command</th><th>Effect</th></tr></thead><tbody>
<tr><td>SBMutateProperty</td><td>Change the field of an object, such the checked state of a checkbox</td></tr>
<tr><td>SBDeleteCommand</td><td>Delete a block</td></tr>
<tr><td>SBInsertCommand</td><td>Insert a block at a given index</td></tr>
<tr><td>SBReplaceCommand</td><td>Replace a block with another</td></tr>
</tbody></table>
<h2 id="custom-commands-1"><a class="header" href="#custom-commands-1">Custom Commands</a></h2>
<p>If you need to perform a more complicated side effect, often a custom command will be the easiest way to perform it.
Custom commands are simple to implement: subclass <code>SBCommand</code> and implement <code>do</code> and <code>undo</code>.
You can consider subclassing from a more specific command, such as the <code>SBDeleteCommand</code> if both a block should disappear and something else should happen in the system.</p>
<p>For a more lightweight alternative, you can also use the general purpose <code>SBDoItCommand</code> and combine it with another command, e.g.:</p>
<pre><code>SBCombinedCommand newWith: {
    SBDoItCommand new
        do: [Transcript showln: 'deleted block'];
        undo: [Transcript showln: 'restored block'. self];
        yourself.
    SBDeleteCommand new
        target: self;
        yourself
}
</code></pre>
<p>But generally, a custom subclass is a preferred, as it allows inspecting the data inside the command more easily.</p>
<h1 id="lists-of-blocks"><a class="header" href="#lists-of-blocks">Lists of Blocks</a></h1>
<p>A common pattern is to have an extensible list of blocks.
For this, we need to do three things:</p>
<ol>
<li>inform the system that our block can take multiple children</li>
<li>inform the system which blocks our block can take as multiple children</li>
<li>add a method that creates new instances of our desired type of children</li>
</ol>
<p><img src="walkthroughs/../assets/lists-of-blocks.png" alt="" /></p>
<h4 id="1-mark-as-list-block"><a class="header" href="#1-mark-as-list-block">1. Mark as List Block</a></h4>
<p>The first step is simple. Assume we have a <code>MyListBlock</code> block subclass. All we need to do is:</p>
<pre><code>MyListBlock&gt;&gt;fixedNumberOfChildren

    ^ false
</code></pre>
<h4 id="2-communicate-block-interfaces"><a class="header" href="#2-communicate-block-interfaces">2. Communicate Block Interfaces</a></h4>
<p>For the second step, we communicate the object interface that the block needs to fulfill:</p>
<pre><code>MyListBlock&gt;&gt;objectInterfaceNear: aBlock at: aSymbol

    ^ {[:o | o isKindOf: MyChildWidget]}
    &quot; or &quot;
    ^ {#isMyChildWidget}
    &quot; or &quot;
    ^ {#isMyChildWidget understood. #isMyChildWidget}
</code></pre>
<p>The symbols or blocks you provide in this list will be checked one by one on the incoming block and only if all return true, the block is allowed to be added.</p>
<h4 id="3-provide-a-creator-method"><a class="header" href="#3-provide-a-creator-method">3. Provide a Creator Method</a></h4>
<p>Lastly, we will want to inform the system what the default block should look like if the user presses the insert-child shortcut.</p>
<pre><code>MyListBlock&gt;&gt;newEmptyChildNear: aBlock before: aBoolean

    ^ MyChildWidget new contents: 'empty'
</code></pre>
<h2 id="autocompletion-at-insert-positions"><a class="header" href="#autocompletion-at-insert-positions">Autocompletion at Insert Positions</a></h2>
<p>If you want to provide an autocompletion popup at insert positions, you need to provide a custom insert command. For example:</p>
<pre><code>MyListBlock&gt;&gt;insertCommandRequest: aMorph near: aBlock before: aBoolean

    ^ MyInsertCommand new
		near: aBlock before: aBoolean in: self morph: aMorph;
		yourself
</code></pre>
<pre><code>MyInsertCommand subclassOf: #SBRelInsertCommand

MyInsertCommand&gt;&gt;suggestions

    &quot; you can access `self container` here if you want to compute these &quot;
    ^ {
        (SBInsertSuggestionItem selector: 'a' label: 'choice')
            morph: (SBTextBubble new contents: 'a') new previewOnly: true.
        (SBInsertSuggestionItem selector: 'b' label: 'choice')
            morph: (SBTextBubble new contents: 'b') new previewOnly: true.
        (SBInsertSuggestionItem selector: 'c' label: 'choice')
            morph: (SBTextBubble new contents: 'c') new previewOnly: true.
    }
</code></pre>
<p>From above, <code>newEmptyChildNear:before:</code> will then only be called if the autocompletion is not used and is thus the default block that will be inserted.</p>
<h1 id="drag-and-drop"><a class="header" href="#drag-and-drop">Drag and Drop</a></h1>
<p>Drag and drop is enabled on all blocks in Sandblocks by default.
Those, that have a Move Decorator, can be picked up via Ctrl+Drag.
If the user holds Shift when starting to drag, the block is instead duplicated instead of moved.</p>
<p>In the previous chapter on lists, we saw that by implementing <code>fixedNumberOfChildren</code>, child blocks can be added to our custom block.
If we do so, dragging another block onto our custom block, will prompt the user to insert the block.</p>
<p>For blocks that do have a <code>fixedNumberOfChildren</code>, dropping a block will instead replace the block.</p>
<h2 id="custom-drop-handling"><a class="header" href="#custom-drop-handling">Custom Drop Handling</a></h2>
<p>If, instead, you want to have custom logic be performed when a block is dropped, implement <code>specialDropCommand:</code> on your block class.
<code>specialDropCommand:</code> receives the candidate block that is about to be dropped onto your block and should return a command that would be executed if the block was released.</p>
<blockquote>
<p>You must never perform side effects in <code>specialDropCommand:</code>, as it is also called to just check whether a special command is available.</p>
</blockquote>
<p>For example, assume our custom block should log the name of the dropped block to the <code>Transcript</code>:</p>
<pre><code>CustomBlock&gt;&gt;specialDropCommand: aBlock

    ^ (SBDoItCommand newFor: self containingArtefact)
        do: [Transcript showln: aBlock asString]
</code></pre>
<h1 id="saving-and-artefacts"><a class="header" href="#saving-and-artefacts">Saving and Artefacts</a></h1>
<p>Artefacts collect changes to blocks and allow saving these changes to the system.
In this video, we create an artefact that acts as a convenient editor over existing Squeak/Smalltalk classes.</p>
<p>We also demonstrate how to generate blocks quickly and conveniently.</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://player.vimeo.com/video/545451309" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe></div>
<h3 id="basic-steps"><a class="header" href="#basic-steps">Basic Steps</a></h3>
<ol>
<li>Create a block subclass</li>
<li>Return <code>true</code> from <code>isArtefact</code></li>
<li>Implement <code>saveTryFixing:quick:</code> and return <code>true</code> or <code>false</code></li>
</ol>
<h3 id="generating-blocks"><a class="header" href="#generating-blocks">Generating Blocks</a></h3>
<p>By using the SBStBuilder class, you can quickly generate or save blocks.
Explore its methods to see more.</p>
<p>To create a block without saving it, do <code>[:b | b to: (b name: 'Object') send: #new] sbStBuild</code>.
If you are creating an artefact, such as a method or class, you can call <code>sbStSave</code> instead, which will build the block, call save on it, and finally return it.</p>
<h1 id="custom-shortcuts"><a class="header" href="#custom-shortcuts">Custom Shortcuts</a></h1>
<p>To register a custom shortcut for your block, do the following:</p>
<ol>
<li>implement a method with the <code>&lt;action&gt;</code> pragma</li>
<li>implement <code>registerShortcuts:</code> on your class</li>
<li>run <code>SBInputMapping updateShortcutProviders</code></li>
</ol>
<p>In more detail:</p>
<h3 id="1-implement-an-action"><a class="header" href="#1-implement-an-action">(1) Implement an Action</a></h3>
<p>In your block class, implement e.g.,</p>
<pre><code>MyBlock&gt;&gt;doubleQuantity
    &lt;action&gt;
    
    self ...
</code></pre>
<h3 id="2-implement-registershortcuts"><a class="header" href="#2-implement-registershortcuts">(2) Implement registerShortcuts</a></h3>
<p>On the <strong>class-side</strong> of your block class, implement e.g.,</p>
<pre><code>MyBlock class&gt;&gt;registerShortcuts: aProvider
    aProvider registerShortcut: $d command do: #doubleQuantity
</code></pre>
<p>For a lot of examples on different ways to specify shortcuts, see <code>SBTextInputMapping&gt;&gt;registerDefaultShortcuts</code>.</p>
<h3 id="3-update-shortcut-providers"><a class="header" href="#3-update-shortcut-providers">(3) Update Shortcut Providers</a></h3>
<p>Finally, just do-it <code>SBInputMapping updateShortcutProviders</code> once and the shortcut should start working.</p>
<h1 id="tree-sitter"><a class="header" href="#tree-sitter">Tree Sitter</a></h1>
<p>In this video, we work with Sandblocks' Tree Sitter backend, giving us access to languages such as Python or Javascript.
We create a replacement for Javascript's <code>window.fetch</code> and a palette for Javascript.</p>
<blockquote>
<p><strong>Notes &amp; Errata</strong></p>
<p>[41min04] instead of calling <code>SBJavascript parse: '2 + 2'</code> it is now recommended to call <code>SBJavascript parseElement: '2 + 2'</code> if we only want a single parsed AST node instead of a full program</p>
<p>[46min09] when we add the <code>factory:</code> call for the palette block, use <code>SBJavascript instance</code> instead of <code>SBJavascript new</code> to avoid rebuilding the grammar.</p>
</blockquote>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%;"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://player.vimeo.com/video/643502024" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe></div>
<h2 id="git-setup-links"><a class="header" href="#git-setup-links">Git Setup Links</a></h2>
<ul>
<li><code>git clone</code> <a href="https://github.com/hpi-swa/sandblocks">git@github.com:hpi-swa/sandblocks</a></li>
<li><code>git clone</code> <a href="https://github.com/hpi-swa-lab/sb-tree-sitter">git@github.com:hpi-swa-lab/sb-tree-sitter</a></li>
</ul>
<h2 id="relevant-entrypoints"><a class="header" href="#relevant-entrypoints">Relevant Entrypoints</a></h2>
<ul>
<li><code>SBTSPalette</code>: superclass for custom palettes. Make sure to look at its class-side.</li>
<li><code>SBInlineBlockReplace</code>: superclass for replacing blocks with custom morphs</li>
<li><code>applyReplacements</code> / <code>Ctrl/Cmd+r</code>: action / shortcut for performing all matching replacements on a block</li>
<li><a href="https://tree-sitter.github.io/tree-sitter/using-parsers#pattern-matching-with-queries">Documentation</a> for Queries in Tree Sitter</li>
<li><a href="https://tree-sitter.github.io/tree-sitter/playground">Playground</a> for parsing and queris in Tree Sitter</li>
</ul>
<h2 id="questions-and-common-patterns"><a class="header" href="#questions-and-common-patterns">Questions and Common Patterns</a></h2>
<h3 id="adding-existing-tree-sitter-blocks-inside-a-replacement"><a class="header" href="#adding-existing-tree-sitter-blocks-inside-a-replacement">Adding Existing Tree Sitter Blocks Inside a Replacement</a></h3>
<p>This is generally easy, just add them as you usually would and include a <code>buildCopy</code> to support undo:</p>
<pre><code class="language-smalltalk">SBBlock new addMorphBack: aTSBlock buildCopy.
</code></pre>
<p>(Without <code>buildCopy</code> the replaced block will contain a hole where the nested block used to be, breaking undo).</p>
<h3 id="adding-new-tree-sitter-blocks-inside-a-replacement"><a class="header" href="#adding-new-tree-sitter-blocks-inside-a-replacement">Adding New Tree Sitter Blocks Inside a Replacement</a></h3>
<p>To create a new instance of a specific rule, use e.g.:</p>
<pre><code>SBBlock new addMorphBack: (SBPython build: 'expression')
</code></pre>
<p>If you need a complete block, you can use <code>parse:</code> or <code>parseElement:</code>:</p>
<pre><code>SBBlock new addMorphBack: (SBPython parseElement: '3 + 4')
</code></pre>
<p>With <code>parseElement:</code>, you get the first child of the toplevel node.
In this specific example, the toplevel node is a <code>program</code>, nesting a <code>binary_operator</code>.
If you need multiple elements, use <code>parse:</code> instead:</p>
<pre><code>SBPython parse:
'def a():
  pass
a()'
</code></pre>
<h3 id="accessing-fields"><a class="header" href="#accessing-fields">Accessing Fields</a></h3>
<p>Many Tree Sitter blocks contain field names, e.g.:</p>
<pre><code class="language-javascript">pair: $ =&gt; seq(
  field('key', $._property_name),
  ':',
  field('value', $.expression)
)
</code></pre>
<p>You can access these using the <code>access</code> helper, e.g.</p>
<pre><code>aPairBlock access key sourceString
</code></pre>
<p>This helper wraps the block in a proxy object that looks up field names and, if matched, returns the corresponding block. All other messages are forwarded to the wrapped block.</p>
<p>A more complex example:</p>
<pre><code class="language-python">ax.set(12, &quot;abc&quot;,
       xlim=(0,8), xticks=np.arange(1,8), ylim=(0,8), yticks=np.arange(1,8))
</code></pre>
<p>Query all arguments as either just plain values or key/value pairs:</p>
<pre><code class="language-smalltalk">self access arguments children collect: [:arg |
  arg type = 'keyword_argument' ifTrue: [arg name contents -&gt; arg value] ifFalse: [arg]]
</code></pre>
<p>Resulting in:</p>
<pre><code>{(integer) . (string) . 'xlim'-&gt;(tuple) . 'xticks'-&gt;(call) . 'ylim'-&gt;(tuple) . 'yticks'-&gt;(call)}
</code></pre>
<p>You can send <code>fields</code> to any block to find what field names this block knows (e.g. a <code>keyword_argument</code> knows <code>name</code> and <code>value</code>).</p>
<h3 id="creating-a-replacement"><a class="header" href="#creating-a-replacement">Creating a Replacement</a></h3>
<ol>
<li>Subclass <code>SBInlineBlockReplace</code>.</li>
<li>Create a matcher function on its class side (see video).</li>
<li>Build your UI.</li>
<li>Implement <code>writeSourceOn:</code> to produce textual source code that is the equivalent of your replacement.</li>
<li>Implement <code>type</code> to inform the system what sort of node you are replacing. For example, if you are replacing a <code>(call)</code> in python, simple return <code>^ 'call'</code> from <code>type</code>.</li>
</ol>
<h1 id="sandblockstreesitter-runtimes"><a class="header" href="#sandblockstreesitter-runtimes">Sandblocks/TreeSitter Runtimes</a></h1>
<p>The runtimes system as part of Sandblocks-TreeSitter allows you to execute code from supported languages.
It comes with support for monitoring its stdout/stderr and injecting watches that report back to the Sandblocks IDE.</p>
<h2 id="opening-and-running-a-file"><a class="header" href="#opening-and-running-a-file">Opening and Running a File</a></h2>
<p>In a Sandblocks workspace, run:</p>
<pre><code>(SBTSFile filepath: '/home/you/test.py') open
</code></pre>
<p>At the top of the file will be a Play button. Once clicked, it will try to find a python interpreter on your system and execute the given file.</p>
<p><img src="walkthroughs/../assets/python-file.png" alt="" /></p>
<h2 id="evaluating-foreign-code"><a class="header" href="#evaluating-foreign-code">Evaluating Foreign Code</a></h2>
<p>If you want to evaluate a snippet of code, use e.g.</p>
<pre><code>SBPython instance runtime evaluate: 'print(&quot;Hello!&quot;)'
</code></pre>
<p>The return value will be the stdout of the program snippet.</p>
<p>To receive stderr or to execute code asynchronously, check if your runtime implements <code>#evaluateFileAsync:cancel:</code>. Refer to its senders for examples on how to use the corresponding API.</p>
<h2 id="watches"><a class="header" href="#watches">Watches</a></h2>
<p>You can insert a watch on any block moment but most likely inserting it on anything but an expression will result in a syntax error upon serialization or execution.
Insert a watch by either right-clicking the expression and filtering for <code>wrapWithWatch</code> or by pressing the Cmd+Shift+W shortcut.</p>
<h2 id="offscreen-watches"><a class="header" href="#offscreen-watches">Offscreen Watches</a></h2>
<p>By placing watches offscreen, you can use them to report values from the runtime back to your TreeSitter replacement blocks.</p>
<p>For example, we could make all Javascript <code>console.log</code> calls log to the Squeak Transcript as well by creating a replacement for <code>console.log</code> and serializing the expression with the watch's source code wrapped around it (see also <code>SBConsoleLogReporter</code> class that comes with Sandblocks):</p>
<pre><code class="language-smalltalk">SBConsoleLogReporter&gt;&gt;initialize
    
    super initialize.
    &quot; create a new empty watch and connect its reportedValue signal to our
      newValue: method &quot;
    watch := SBTSWatch newEmpty when: #reportedValue send: #newValue: to: self

SBConsoleLogReporter&gt;&gt;writeSourceOn: aStream

    &quot; update the watch's expression to the expression our replacement is wrapping &quot;
	watch expression: self expression.
	
	aStream nextPutAll: 'console.log('.
	watch writeSourceOn: aStream.
	aStream nextPutAll: ')'

SBConsoleLogReporter&gt;&gt;newValue: aString

    &quot; apparently our watch triggered a reportedValue signal, so we're called &quot;
    Transcript showln: aString
</code></pre>
<p>You can also use this with custom code to extract specific values from the runtime:</p>
<pre><code class="language-smalltalk">SBRequestReplacement&gt;&gt;initialize

    watch := SBTSWatch newEmpty when: #reportedValue send: #newRequest: to: self

SBRequestReplacement&gt;&gt;writeSourceOn: aStream

    &quot; we are inserting this object literal in the code that expects a `req` variable
      to be in the local scope and reporting the object back to squeak &quot;
    watch expression: (SBJavascript parseElement:
        '{path: req.path, headers: req.headers.map(h =&gt; [h.key, h.value])}').

    &quot; ...our other serialization code, then our watch at a place where it's
      syntactically valid &quot;
    watch writeSourceOn: aStream.
    &quot; ...more serialization code &quot;

SBRequestReplacement&gt;&gt;newRequest: aString

   &quot; we get the data as a string, which we can then decode &quot;
   data := Json readFrom: aString.
   Transcript showln: data headers
</code></pre>
<h2 id="pretty-printing"><a class="header" href="#pretty-printing">Pretty-Printing</a></h2>
<p>Runtimes may support pretty printing code. If they do, whenever code is serialized to text (e.g., when copying or writing to a file), the <code>#prettySourceString</code> is called on the block, which passes the regular <code>#sourceString</code> of the block to the external pretty printer.</p>
<h2 id="javascript-web-runtime"><a class="header" href="#javascript-web-runtime">Javascript Web Runtime</a></h2>
<p>The Javascript web runtime is special in that it does not actually invoke any programs.
Instead, it will only spawn a server that listens for watches to trigger.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
